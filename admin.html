<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - KR</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="static/img/KRICON.png">
    <script>
        console.log('admin page loaded');
    </script>
</head>
<body class="collab-page-body">
    <nav class="kr-navbar">
        <a href="index.html" style="text-decoration:none;color:#ffffff;"><img src="static/img/networkicon.png" class="nav-icon" alt="Network"> NETWORK</a>
        <a href="collab.html" style="text-decoration:none;color:#ffffff;"><img src="static/img/collabicon.png" class="nav-icon" alt="Collab"> COLLAB</a>
        <a href="profile.html" style="text-decoration:none;color:#ffffff;">JOIN</a>
        <a href="admin.html" style="text-decoration:none;color:#ff00ff;">ADMIN</a>
    </nav>

    <a href="index.html">
        <img src="static/img/WHITE KRLOGO.png" alt="KR Logo" id="fixed-top-logo">
    </a>

    <div id="loading-indicator" style="display: none; text-align: center; padding: 50px; color: white;">Loading...</div>

    <div id="login-prompt" style="display: none; text-align: center; padding: 40px; color: white;">
        <h1>Access Denied</h1>
        <p>You do not have permission to view this page.</p>
        <p style="margin-top: 15px;">If you are an administrator, please log in.</p>
        <a href="profile.html" style="display: inline-block; padding: 10px 20px; background-color: #0000ff; color: white; text-decoration: none; border-radius: 50px; margin-top: 20px;">Login</a>
    </div>

    <div id="admin-content" style="display: none; padding-top: 120px; color: white;">
        <div class="admin-layout">
            <aside class="admin-sidebar">
                <div class="admin-nav-card" data-target="#users-section">Users</div>
                <div class="admin-nav-card" data-target="#posts-section">Collab Posts</div>
                <div class="admin-nav-card" data-target="#sendnotif-section">Send Notification</div>
                <div class="admin-nav-card" data-target="#notification-browser-container">Notifications</div>
                <div class="admin-nav-card" data-target="#global-blocks-section">Global Blocks</div>
            </aside>
            <div class="admin-main">
                <div id="admin-dashboard">
                    <h1 style="text-align: center;">Admin Dashboard</h1>

                    

                    <div class="admin-section" id="users-section">
                        <h2>Users</h2>
                        <div class="user-filters">
                            <input type="text" id="search-input" placeholder="Search users by name or email...">
                        </div>
                        <div id="user-list"></div>
                    </div>

                    <div class="admin-section" id="posts-section">
                        <h2>Collaboration Posts</h2>
                        <div id="posts-list"></div>
                    </div>
                    
                    <div class="admin-section" id="sendnotif-section">
                        <h2>Send Notification</h2>
                        <form id="send-notification-form">
                            <div class="form-field">
                                <label for="notification-target">Target Users</label>
                                <select id="notification-user-select" class="input-feild collab-input-field" multiple></select>
                                <small>Select one or more users. Hold Ctrl/Cmd to select multiple.</small>
                            </div>
                            <div class="form-field">
                                <label for="notification-category">Category</label>
                                <select id="notification-category" class="input-feild collab-input-field">
                                    <option>KR News</option>
                                    <option>Connection Request</option>
                                    <option>Collaboration</option>
                                    <option>Update</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="notification-title">Title</label>
                                <input type="text" id="notification-title" class="input-feild collab-input-field" required>
                            </div>
                            <div class="form-field">
                                <label for="notification-message">Body</label>
                                <textarea id="notification-message" class="input-feild collab-input-field" rows="4" required></textarea>
                            </div>
                            <div class="form-field">
                                <label for="notification-image-url">Image URL (Optional)</label>
                                <input type="url" id="notification-image-url" class="input-feild collab-input-field">
                            </div>
                            <div class="form-field">
                                <label for="notification-link">"View More" Link (Optional)</label>
                                <input type="url" id="notification-link" class="input-feild collab-input-field">
                            </div>
                            <div class="form-actions">
                                <button type="submit" id="send-notification-btn" class="primary-btn">Send Notification</button>
                                <button type="button" id="cancel-edit-btn" style="display: none;" class="secondary-btn">Cancel Edit</button>
                            </div>
                        </form>
                    </div>

                    <div class="admin-section" id="notification-browser-container">
                        <h2>Notification Browser</h2>
                        <div class="notification-filters">
                            <input type="text" id="notification-search-input" class="input-feild" placeholder="Search by keyword...">
                            <input type="text" id="notification-user-filter-input" class="input-feild" placeholder="Filter by user email...">
                            <button id="clear-notification-filters-btn" class="secondary-btn">Clear</button>
                        </div>
                        <div id="sent-notifications-list">
                            <!-- Sent notifications will be dynamically loaded here -->
                        </div>
                    </div>

                    <div class="admin-section" id="global-blocks-section">
                        <h2>Global Blocks</h2>
                        <div class="user-filters">
                            <input type="text" id="blocks-search-input" placeholder="Search blocks by title or owner...">
                            <select id="gb-sort-select" style="margin-left:8px;">
                                <option value="recent">Most Recent</option>
                                <option value="votes">Most Votes</option>
                                <option value="relevant">Most Relevant</option>
                            </select>
                        </div>
                        <div id="blocks-list"></div>
                        <button id="load-more-blocks-btn" class="secondary-btn" style="margin-top:10px;">Load More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" style="display: none;" class="modal">
        <div class="modal-content" style="color: black;">
            <span class="close-button">&times;</span>
            <h2>Edit User</h2>
            <div id="edit-user-form-container">
                <!-- User form will be dynamically generated here -->
            </div>
        </div>
    </div>

    <!-- Edit Post Modal -->
    <div id="edit-post-modal" style="display: none;" class="modal">
        <div class="modal-content" style="color: black;">
            <span class="close-button">&times;</span>
            <h2>Edit Post</h2>
            <div id="edit-post-form-container">
                <!-- Form will be dynamically generated here -->
            </div>
        </div>
    </div>

    <!-- Edit Block Modal -->
    <div id="admin-edit-block-modal" style="display: none;" class="modal">
        <div class="modal-content" style="color: black;">
            <span class="close-button">&times;</span>
            <h3 id="admin-modal-title">Add Block</h3>
            <div id="admin-block-type-select" style="display: flex; gap: 12px; justify-content: center; margin-bottom: 1rem;">
                <div class="block-type-card selected" data-type="default">
                    <div class="block-type-icon default-icon"></div>
                    <div class="block-type-label">Default</div>
                </div>
                <div class="block-type-card" data-type="large-image">
                    <div class="block-type-icon large-image-icon"></div>
                    <div class="block-type-label">Large Image</div>
                </div>
                <div class="block-type-card" data-type="carousel">
                    <div class="block-type-icon carousel-icon"></div>
                    <div class="block-type-label">Slide Carousel</div>
                </div>
            </div>
            <div id="admin-block-live-preview" style="margin-bottom: 1rem;"></div>
            
            <div id="admin-block-fields-default-large">
                <p class="input-feild-title-text">URL:</p>
                <input type="url" id="admin-block-link" class="input-feild collab-input-field" placeholder="Paste a link to get started...">
                <div id="admin-url-loading-indicator"></div>
                <div id="admin-embed-options" style="margin-top:8px; display:none;">
                    <p class="input-feild-title-text">Or, Embed:</p>
                    <button id="admin-embed-youtube-btn" class="secondary-btn" type="button" disabled>Embed YouTube</button>
                    <button id="admin-embed-spotify-btn" class="secondary-btn" type="button" disabled>Embed Spotify</button>
                    <p id="admin-embed-hint" style="font-size: 0.85em; color: #6e6e6e; margin-top: 6px;">Paste a YouTube or Spotify link above, then choose an embed option.</p>
                </div>
                <div id="admin-block-details-container" style="display: none;">
                    <p class="input-feild-title-text" style="margin-top: 10px;">Title:</p>
                    <input type="text" id="admin-block-title" class="input-feild collab-input-field" placeholder="Block Title">
                    <p class="input-feild-title-text" style="margin-top: 10px;">Description:</p>
                    <input type="text" id="admin-block-description" class="input-feild collab-input-field" placeholder="Block Description">
                    <p class="input-feild-title-text" style="margin-top: 10px;">Upload Block Image:</p>
                    <input type="file" id="admin-block-img" accept="image/*">
                    <div id="admin-image-preview" style="margin-top: 10px;"></div>
                </div>
            </div>
            <div id="admin-block-fields-carousel" style="display:none;">
                <div id="admin-carousel-slides-fields"></div>
                <button id="admin-add-carousel-slide" type="button" class="primary-btn" style="margin-top: 10px; padding: 6px 12px; font-size: 14px;">+ Add Slide</button>
            </div>
            <div class="form-actions" style="margin-top: 20px;">
                <button id="admin-save-block" class="primary-btn">Save Block</button>
                <button id="admin-cancel-block" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Global Block Modal -->
    <div id="edit-global-block-modal" class="modal" style="display:none;">
        <div class="modal-content" style="color:black;">
            <span class="close-button">&times;</span>
            <h2>Edit Global Block</h2>
            <form id="edit-global-block-form">
                <div class="form-field">
                    <label>Title</label>
                    <input type="text" id="gb-title" class="input-feild" required>
                </div>
                <div class="form-field">
                    <label>Description</label>
                    <textarea id="gb-desc" class="input-feild" rows="3"></textarea>
                </div>
                <div class="form-field">
                    <label>Link (optional)</label>
                    <input type="url" id="gb-link" class="input-feild">
                </div>
                <div class="form-field">
                    <label>Icon URL</label>
                    <input type="url" id="gb-icon" class="input-feild">
                </div>
                <div class="form-field">
                    <label>Created At</label>
                    <input type="datetime-local" id="gb-created" class="input-feild">
                </div>
                <h3>Comments</h3>
                <div id="gb-comments-list" style="max-height:220px;overflow:auto;border:1px solid #ccc;padding:6px;border-radius:4px;"></div>
                <div class="form-actions" style="margin-top:15px;">
                    <button type="submit" id="gb-save-btn" class="primary-btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="collab-firebase-setup.js"></script>
    <script type="module" src="admin-app.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css" rel="stylesheet" />
</body>
</html>
<style>
.admin-section {
    background-color: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 15px;
    margin: 20px auto;
    width: 90%;
    max-width: 1200px;
}
.admin-section h2 {
    color: #fff;
    border-bottom: 2px solid #0000ff;
    padding-bottom: 10px;
}
/* Basic Modal Styles - can be improved */
.modal {
  display: none;
  position: fixed;
  z-index: 1001;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.7);
}
.modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 700px;
  border-radius: 5px;
  max-height: 90vh;
  overflow-y: auto;
}
.close-button {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.input-feild-title-text {
    margin-bottom: 0 !important;
    font-size: 14px;
    font-weight: bold;
    color: #333;
}

.block {
    background-color: #ffffff;
    border-radius: 8px;
    padding: 0.5rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.2);
    color: #333;
}
.block-content {
    display: flex;
    align-items: center;
    gap: 12px;
}
.block-text {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.block img {
    height: 40px;
    width: 40px;
    object-fit: cover;
    border-radius: 4px;
}
.block-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}
.block-actions button {
    padding: 4px 8px;
    font-size: 12px;
}
.block-actions .admin-delete-btn {
    background: #ff4444;
}

.drag-handle {
    cursor: move;
    padding: 8px;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 12px;
    height: 24px;
    border-radius: 4px;
    background: #f0f0f0;
    margin-right: 8px;
    position: relative;
}

.block-type-card {
    border: 2px solid #ccc;
    border-radius: 10px;
    padding: 10px 16px;
    background: #fafafa;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: border 0.2s, box-shadow 0.2s;
    min-width: 90px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}
.block-type-card.selected {
    border: 2.5px solid #0000ff;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.10);
    background: #f0f6ff;
}
.block-type-icon {
    width: 112px;
    height: 71px;
    margin-bottom: 6px;
    background-color: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
}
.default-icon {
    background-image: url('static/img/defaultlink-icon.jpg');
}
.large-image-icon {
    background-image: url('static/img/largeimg-icon.jpg');
    border-radius: 8px;
}
.carousel-icon {
    background-image: url('static/img/carousel-icon.jpg');
}
.block-type-label {
    font-size: 0.95em;
    font-weight: bold;
    color: #222;
    text-align: center;
}

#admin-block-live-preview {
    min-height: 80px;
    background: #f7f7f7;
    border-radius: 8px;
    border: 1.5px solid #e0e0e0;
    padding: 12px;
    margin-bottom: 1rem;
    color: #333;
}
#admin-carousel-slides-fields > .carousel-slide-field {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 10px;
    background: #fafbff;
}
.carousel-slide-field button {
    background-color: #ff4444;
    font-size: 12px;
    padding: 4px 8px;
    margin-top: 5px;
}

.practice-pill {
    border: 1px solid #007bff;
    color: #007bff;
    background: none;
    border-radius: 999px;
    padding: 4px 10px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    margin: 2px;
    display: inline-block;
}
.practice-pill.selected {
    background: #007bff;
    color: #fff;
}

#crop-confirm{
    z-index: 9999999;
    position: sticky;
}

/* Avatar Upload Styles */
.avatar-upload-section {
    text-align: center;
}

.avatar-preview-container {
    margin-bottom: 10px;
}

.file-upload-wrapper {
    position: relative;
    display: block;
    text-align: center;
    margin-bottom: 10px;
}

.file-upload-input {
    position: absolute;
    left: 0;
    top: 0;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.file-upload-button {
    padding: 6px 12px;
    background: #8d8d8d;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    display: inline-block;
}

.file-upload-name {
    margin-left: 8px;
}

/* Cropper Modal Styles */
.cropper-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100001;
}

.cropper-modal-content {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    max-width: 90%;
    max-height: 90vh;
    overflow: auto;
}

.cropper-image-container {
    max-height: 70vh;
    margin-bottom: 1rem;
}

.cropper-image-container img {
    max-width: 100%;
    display: block;
}

.cropper-buttons {
    text-align: center;
}
</style> 